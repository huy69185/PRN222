@page
@model ClassroomBooking.Presentation.Pages.Manager.Rooms.DetailsModel
@{
    ViewData["Title"] = "Room Details";
}

<h2>Room Details</h2>

@if (Model.Room == null)
{
    <p>Room not found.</p>
}
else
{
    <!-- Room Details Card -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h3>Room Information</h3>
        </div>
        <div class="card-body" style="background-color: #f0f8ff;">
            <div class="row">
                <div class="col-sm-3"><strong>Room Name</strong></div>
                <div class="col-sm-9">@Model.Room.RoomName</div>
            </div>
            <div class="row">
                <div class="col-sm-3"><strong>Capacity</strong></div>
                <div class="col-sm-9">@Model.Room.Capacity</div>
            </div>
            <div class="row">
                <div class="col-sm-3"><strong>Campus</strong></div>
                <div class="col-sm-9">@Model.Room.Campus?.CampusName</div>
            </div>
            <div class="row">
                <div class="col-sm-3"><strong>Status</strong></div>
                <div class="col-sm-9">
                    @if (Model.Room.Status == "Occupied")
                    {
                        <span class="text-danger">@Model.Room.Status</span>
                    }
                    else if (Model.Room.Status == "Available")
                    {
                        <span class="text-success">@Model.Room.Status</span>
                    }
                    else if (Model.Room.Status == "Maintenance")
                    {
                        <span class="text-warning">@Model.Room.Status</span>
                    }
                    else
                    {
                        @Model.Room.Status
                    }
                </div>
            </div>
            <div class="row">
                <div class="col-sm-3"><strong>Description</strong></div>
                <div class="col-sm-9">@Model.Room.Description</div>
            </div>
        </div>
    </div>

    <!-- Bookings Section -->
    <h3>Bookings for this Room</h3>
    <!-- Nút sắp xếp -->
    <div class="mb-3">
        <a href="?id=@Model.Room.RoomId&sortOrder=asc&pageNumber=@ViewData["CurrentPage"]"
           class="btn btn-outline-primary @(ViewData["SortOrder"] == "asc" ? "active" : "")">
            Sắp xếp tăng dần
        </a>
        <a href="?id=@Model.Room.RoomId&sortOrder=desc&pageNumber=@ViewData["CurrentPage"]"
           class="btn btn-outline-primary @(ViewData["SortOrder"] == "desc" ? "active" : "")">
            Sắp xếp giảm dần
        </a>
    </div>

    @if (Model.BookingList.Any())
    {
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Booking ID</th>
                    <th>Student</th>
                    <th>Start Time</th>
                    <th>End Time</th>
                    <th>Purpose</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var booking in Model.BookingList)
                {
                    <tr>
                        <td>@booking.BookingId</td>
                        <td>@(booking.User != null ? booking.User.FullName : "Unknown")</td>
                        <td>@booking.StartTime.ToString("dd/MM/yyyy HH:mm")</td>
                        <td>@booking.EndTime.ToString("dd/MM/yyyy HH:mm")</td>
                        <td>@booking.Purpose</td>
                        <td>
                            @if (booking.BookingStatus == "Pending")
                            {
                                <span class="text-warning">@booking.BookingStatus</span>
                            }
                            else if (booking.BookingStatus == "Approved")
                            {
                                <span class="text-success">@booking.BookingStatus</span>
                            }
                            else if (booking.BookingStatus == "Denied")
                            {
                                <span class="text-danger">@booking.BookingStatus</span>
                            }
                            else if (booking.BookingStatus == "Cancelled")
                            {
                                <span style="color: orangered;">@booking.BookingStatus</span>
                            }
                            else
                            {
                                @booking.BookingStatus
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <!-- Pagination Controls -->
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                @if ((int)ViewData["CurrentPage"] > 1)
                {
                    <li class="page-item">
                        <a class="page-link" href="?id=@Model.Room.RoomId&pageNumber=@((int)ViewData["CurrentPage"] - 1)&sortOrder=@ViewData["SortOrder"]">Previous</a>
                    </li>
                }
                else
                {
                    <li class="page-item disabled">
                        <a class="page-link" href="#">Previous</a>
                    </li>
                }

                @for (int i = 1; i <= (int)ViewData["TotalPages"]; i++)
                {
                    <li class="page-item @(i == (int)ViewData["CurrentPage"] ? "active" : "")">
                        <a class="page-link" href="?id=@Model.Room.RoomId&pageNumber=@i&sortOrder=@ViewData["SortOrder"]">@i</a>
                    </li>
                }

                @if ((int)ViewData["CurrentPage"] < (int)ViewData["TotalPages"])
                {
                    <li class="page-item">
                        <a class="page-link" href="?id=@Model.Room.RoomId&pageNumber=@((int)ViewData["CurrentPage"] + 1)&sortOrder=@ViewData["SortOrder"]">Next</a>
                    </li>
                }
                else
                {
                    <li class="page-item disabled">
                        <a class="page-link" href="#">Next</a>
                    </li>
                }
            </ul>
        </nav>
    }
    else
    {
        <p>No bookings found for this room.</p>
    }

    <a asp-page="/Manager/Rooms/Index" class="btn btn-secondary">Back to List</a>
}

@if (!string.IsNullOrEmpty(TempData["ErrorMessage"]?.ToString()))
{
    <div class="alert alert-danger mt-3">
        @TempData["ErrorMessage"]
    </div>
}

@section Scripts {
    <script>
        window.currentRoomId = "@Model.Room?.RoomId";
        console.log("Current room ID =", window.currentRoomId);
    </script>
}